{
  "rules": {
    ".read": false,
    ".write": false,
    
    "clubs": {
      ".read": false,
      ".write": false,
      "$clubId": {
        ".read": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).exists()",
        ".write": false,
        
        "info": {
          ".read": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).exists()",
          ".write": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'admin'",
          ".validate": "newData.hasChildren(['name', 'createdAt', 'createdBy'])"
        },
        
        "members": {
          ".read": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).exists()",
          ".write": false,
          "$uid": {
            ".read": "auth != null && (auth.uid === $uid || root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'admin')",
            ".write": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'admin'",
            ".validate": "newData.hasChildren(['login', 'email', 'nome', 'role', 'status', 'joinedAt'])"
          }
        },
        
        "jogadores": {
          ".read": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('status').val() === 'approved'",
          ".write": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('status').val() === 'approved' && (root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'diretor' || root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'admin')",
          ".indexOn": ["id", "nome"],
          "$jogadorId": {
            ".validate": "newData.hasChildren(['id', 'nome', 'posicao'])"
          }
        },
        
        "jogos": {
          ".read": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('status').val() === 'approved'",
          ".write": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('status').val() === 'approved' && (root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'diretor' || root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'admin')",
          ".indexOn": ["id", "data"],
          "$jogoId": {
            ".validate": "newData.hasChildren(['id', 'data', 'adversario'])"
          }
        },
        
        "financeiro": {
          ".read": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('status').val() === 'approved' && (root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'diretor' || root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'admin')",
          ".write": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('status').val() === 'approved' && (root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'diretor' || root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'admin')",
          ".indexOn": ["id", "tipo"],
          "$financeiroId": {
            ".read": true,
            ".write": "(auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('status').val() === 'approved' && (root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'diretor' || root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'admin')) && ((newData.exists() && !data.exists()) || (now - data.child('timestamp').val() < 7776000000))",
            ".validate": "newData.hasChildren(['id', 'tipo', 'valor', 'mes', 'categoria', 'timestamp'])"
          }
        },
        
        "categorias_financeiras": {
          ".read": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('status').val() === 'approved' && (root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'diretor' || root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'admin')",
          ".write": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('status').val() === 'approved' && root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'admin'",
          ".indexOn": ["tipo"],
          "entrada": {
            "$catId": {
              ".validate": "newData.hasChildren(['id', 'nome', 'tipo']) && newData.child('tipo').val() === 'entrada'"
            }
          },
          "saida": {
            "$catId": {
              ".validate": "newData.hasChildren(['id', 'nome', 'tipo']) && newData.child('tipo').val() === 'saida'"
            }
          }
        },
        
        "logs": {
          ".read": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('status').val() === 'approved' && root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'admin'",
          ".write": "auth != null && root.child('clubs').child($clubId).child('members').child(auth.uid).child('status').val() === 'approved' && root.child('clubs').child($clubId).child('members').child(auth.uid).child('role').val() === 'admin'",
          ".indexOn": ["timestamp", "usuario", "acao"],
          "$logId": {
            ".read": true,
            ".write": "newData.val() == null && (now - data.child('timestamp').val() > 7776000000)",
            ".validate": "newData.hasChildren(['id', 'usuario', 'role', 'acao', 'descricao', 'timestamp'])"
          }
        }
      }
    },
    
    "userClubs": {
      ".read": false,
      ".write": false,
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid",
        "$clubId": {
          ".validate": "newData.hasChildren(['clubId', 'clubName', 'joinedAt'])"
        }
      }
    }
  }
}
